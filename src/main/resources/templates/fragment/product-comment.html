<div th:fragment="product-comment">
  <section id="comments" class="mt-4">
    <h3>Bình luận & Đánh giá</h3>

    <!-- Danh sách bình luận -->
    <ul id="comment-list" class="list-unstyled mt-3">
      <li th:each="c : ${comments}" class="border-bottom py-2">
        <div class="d-flex align-items-start gap-2">
          <div class="avatar rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center"
               style="width: 40px; height: 40px;">
            <span th:text="${(c.user != null && c.user.username != null) ? #strings.substring(c.user.username,0,1).toUpperCase() : 'U'}"></span>
          </div>
          <div style="flex:1;">
            <strong th:text="${c.user != null ? c.user.username : 'Người dùng'}"></strong>
            <small class="text-muted ms-2" th:text="${#dates.format(c.datePost,'dd/MM/yyyy HH:mm')}"></small>

            <!-- Hiển thị sao -->
            <div>
              <span th:each="i : ${#numbers.sequence(1,5)}">
                <i th:classappend="${i <= c.rating} ? 'fas fa-star text-warning' : 'far fa-star text-secondary'"></i>
              </span>
            </div>

            <p class="mt-1 mb-0" th:text="${c.content}"></p>
          </div>
        </div>
      </li>
    </ul>

    <!-- Form bình luận -->
    <div class="mt-3" sec:authorize="hasRole('USER')">
      <h5>Viết bình luận của bạn</h5>
	  <form id="comment-form"
	        th:action="@{/comment/{productName}(productName=${product.name})}"
	        method="post">
        <div class="mb-2">
          <label>Chọn số sao:</label><br>
          <span class="rating">
            <input type="radio" name="rating" value="5" id="star5"><label for="star5">★</label>
            <input type="radio" name="rating" value="4" id="star4"><label for="star4">★</label>
            <input type="radio" name="rating" value="3" id="star3"><label for="star3">★</label>
            <input type="radio" name="rating" value="2" id="star2"><label for="star2">★</label>
            <input type="radio" name="rating" value="1" id="star1" checked><label for="star1">★</label>
          </span>
        </div>
        <textarea id="comment-content" name="content" class="form-control" rows="3" placeholder="Nhập bình luận..." required></textarea>
        <button type="submit" class="btn btn-primary mt-2">Gửi</button>
      </form>
    </div>

    <div sec:authorize="!hasRole('USER')" class="mt-3">
      <a th:href="@{/sign-in}">Đăng nhập</a> để bình luận.
    </div>
  </section>

  <!-- CSS sao -->
  <style>
    .rating {
      direction: rtl;
      display: inline-flex;
    }
    .rating input { display: none; }
    .rating label {
      font-size: 24px;
      color: #ccc;
      cursor: pointer;
      transition: color 0.2s;
    }
    .rating input:checked ~ label,
    .rating label:hover,
    .rating label:hover ~ label {
      color: #ffc107;
    }
  </style>
</div>
